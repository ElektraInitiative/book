\input{setup}

\title{L03 Development Tools}

\begin{document}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% 
\section{Scripts}

\begin{frame}<1>[label=learning outcomes]
	\frametitle{Learning Outcomes}
	After successful completion of L03 \\
	students will be able to

	\begin{itemize}
	\item remember how development tools help
	\item make modifications in scripts
	\end{itemize}
\end{frame}

\begin{frame}[label=scripts]
	\frametitle{Scripts}

	FLOSS encourages to:

	\begin{itemize}[<+-| alert@+>]
	\item combine
	\item modify
	\item share
	\end{itemize}

	\pause[\thebeamerpauses]

	\begin{finding}
	Can be easily done using scripts.
	\end{finding}
\end{frame}

\begin{frame}[fragile,label=portable shell scripts]
	\frametitle{Portable Shell Scripts}

	\begin{itemize}[<+-| alert@+>]
	\item defined by POSIX
	\item supported by most shells like bash, zsh, ...
	\item use \verb+#!/bin/sh+ as shebang
	\end{itemize}

	\pause[\thebeamerpauses]
	development tools:

	\begin{itemize}[<+-| alert@+>]
	\item checkbashisms (in devscripts, check\_bashisms)
	\item shfmt (check\_posix)
	\item shellcheck
	\end{itemize}
\end{frame}

\begin{frame}[fragile]
	\frametitle{Reformatting (1)}

	Serial variant of scripts/dev/reformat-all

	\begin{lstlisting}[language=sh]
#!/bin/sh
#
# @author Klemens
# @brief Calls all other reformat scripts
# @date 29.03.2019
# @tags reformat

DEV_SCRIPTS_DIR=$(dirname "$0")
. "${DEV_SCRIPTS_DIR}/include-common"

cd "$SOURCE" || exit

\end{lstlisting}
\end{frame}

\begin{frame}[fragile]
	\frametitle{Reformatting (2)}

	\begin{lstlisting}[language=sh,firstnumber=last]
reformat() {
	reformat=$1
	shift
	echo "starting $reformat ..."
	"$reformat" "$@"
	echo "finished $reformat"
}

IFS='
'
for reformat in "$DEV_SCRIPTS_DIR"/reformat-*; do
	[ "$(basename "$reformat")" = "reformat-all" ] && continue
	reformat "$reformat" "$@"
done\end{lstlisting}
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% 
\section{Build Tools}

\begin{frame}[label=build script goals]
	\frametitle{Goals}

	Build tools:

	\begin{itemize}[<+-| alert@+>]
	\item (cross-)compile the software
	\item generate documentation and other files
	\item run scripts, shared with build server
	\item run tests (e.g., ctest)
	\item create packages (e.g., cpack)
	\end{itemize}
\end{frame}

\begin{frame}<1-3>[label=generation]
	\frametitle{Generation}

	How build tools typically:

	\begin{itemize}[<+-| alert@+>]
	\item e.g.\ automake generates \texttt{./configure} shell scripts, which generates Makefiles
	\item e.g.\ CMake generates Makefiles, Ninja or project files of various IDEs
	\item other build tools directly invoke the compiler
	\end{itemize}

	\only<10>{
	\begin{task}
	Which build tool do you know?
	How does it work?
	\end{task}
	}
\end{frame}

\begin{frame}
	\frametitle{Example: Elektra Plugins}

	README.md of plugins is used:

	\vspace{1em}
	\pause

	\begin{description}[<+-| alert@+>]
	\item[during configure time:] include/exclude plugins based on \texttt{infos/status}
	\item[during build time:] README.md gets included in the plugin's code
	\item[at run time:] mounting plugins using \texttt{infos/provides}
	\end{description}

	\vspace{1em}
	\pause[\thebeamerpauses]

	Implementation see \texttt{scripts/cmake/Modules/LibAddPlugin.cmake}
\end{frame}

\begin{frame}[fragile]
	\frametitle{CMake: Different Configurations}

	Common variants of how to run cmake are in \texttt{scripts/dev/configure-*}

	\begin{lstlisting}[language=sh]
cmake \
-DPLUGINS="ALL;-EXPERIMENTAL" \
-DTOOLS="ALL" \
-DENABLE_DEBUG="ON" \
-DENABLE_LOGGER="ON" \
.\end{lstlisting}
\end{frame}

\begin{frame}[fragile]
	\frametitle{Environment}

	\begin{enumerate}
	\item use Docker
	\item \lstinline{. scripts/dev/run_env} which basically does:

	\begin{lstlisting}[language=sh]
# common configure script
export SCRIPTS_DIR="${ELEKTRA_DIR}/scripts/dev"
. "${SCRIPTS_DIR}/include-common"

export PATH="$BUILD/bin:$SCRIPTS_DIR:$PATH"
export KDB_EXEC_PATH="$COMMON_PATH:$KDB_EXEC_PATH"
export LD_LIBRARY_PATH="$BUILD/lib:$LD_LIBRARY_PATH"
export MANPATH="$SOURCE/doc/man:$MANPATH"
export CLASSPATH="$CLASSPATH:$BUILD/lib/libelektra.jar"

export PS1="[DEV] $PS1"\end{lstlisting}
	\end{enumerate}
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% 
\section{Development Tools}

\begin{frame}[label=i18n and L10n]
	\frametitle{Use Tools or Libraries?}

	Example: Internationalization (i18n) and Localization (L10n)

	\begin{itemize}[<+-| alert@+>]
	\item self-made key/value lookup
	\item GNU gettext model, plural, context
	\end{itemize}

	\pause[\thebeamerpauses]

	\begin{finding}
	Quickly pays off to learn FLOSS tools.
	\end{finding}
\end{frame}

\begin{frame}[label=licencing]
	\frametitle{Licensing Check Tools}

	If you copy FLOSS to Elektra's source, make sure:

	\begin{itemize}[<+-| alert@+>]
	\item it is BSD-licensed (or less restricted)
	\item license information is added in \texttt{.reuse/dep5}
	\end{itemize}

	\pause[\thebeamerpauses]

	\url{https://reuse.software/}
\end{frame}

\begin{frame}[label=test tools]
	\frametitle{Elektra's Test Tools}

	See \texttt{doc/TESTING.md}:

	\begin{itemize}[<+-| alert@+>]
	\item valgrind
	\item ASAN
	\item AFL++
	\item Shell Recorder
	\end{itemize}
\end{frame}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% 
\section{Meeting}

\subsection{Recapitulation}

\againframe<2>{learning outcomes}

\begin{frame}
	\frametitle{Portable Shell Scripts}

	What is a shebang?

	Which tools help developing portable shell scripts?
\end{frame}
\againframe<10>{portable shell scripts}

\begin{frame}
	\frametitle{Goals}

	What are the goals of build tools?
\end{frame}
\againframe<10>{build script goals}

\againframe<10>{generation}

\begin{frame}
	\frametitle{Test Tools}

	\begin{itemize}[<+-| alert@+>]
	\item Presentation: Selenium and Cucumber
	\item Which other test tools do you know?
	Share your experiences.
	\end{itemize}
\end{frame}

\againframe<10>{test tools}

\breakframe

\begin{frame}
	\frametitle{Docker}

	Reformatting\&Test execution in Docker

	Did the tutorials help you?

	A. Yes \\
	B. No: Didn't work \\
	C. No: Prefer different way \\
	D. Didn't try
\end{frame}

\begin{frame}
	\frametitle{development tools}

	\begin{task}
	Elevator-Pitch for your favorite development tool.
	How did it help you?
	\end{task}
\end{frame}

\breakframe


\subsection{Assignments}

\begin{assignment}
	\frametitle{H2}

	\begin{task}
	Problems on specific issues or PRs?
	\end{task}
\end{assignment}

\begin{assignment}
	\frametitle{P0}

	\begin{task}
	Reviews finish today, next week upload corrections.
	\end{task}
\end{assignment}

\begin{frame}
	\frametitle{Feedback Talk}

	\hfill \includegraphics[width=2cm]{pics/feedback.png}
	\vspace{-1cm}
	\begin{itemize}
		\item Difficulties in P0/H2?
		\item ECTS breakdown realistic?
		\item Best/Worst Videos?
	\end{itemize}
\end{frame}

\subsection{Preview}

\begin{frame}
	\frametitle{L04 Continuous Integration}
\end{frame}


\end{document}
