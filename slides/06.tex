%TODO: add cliffhanger with preview for next time
%TODO: add learning outcome slide
%TODO: shorten team work+move earlier

\input{setup}

\date{22.05.2018}

\begin{document}

\renewcommand{\enquote}[1]{\emph{``#1''}} % Cannot be done earlier

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
	\titlepage
	\doclicenseThis
\end{frame}

\begin{frame}
	Lecture is every week Wednesday 09:00 - 11:00.

	\begin{description}
		\item[06.03.2019:] {\color{gray}topic, teams}
		\item[13.03.2019:] {\color{gray}TISS registration, initial PR}
		\item[20.03.2019:] {\color{gray}other registrations, guest lecture}
		\item[27.03.2019:] {\color{gray}PR for first issue done, second started}
		\item[03.04.2019:] {\color{gray}first issue done, PR for second}
		\item[10.04.2019:] {\color{gray}mid-term submission of exercises}
		\item[08.05.2019:] {\color{gray}different location: Complang Libary}
		\item[15.05.2019:]
		\item[22.05.2019:] {\color{red}all 5 issues done}
		\item[29.05.2019:]
		\item[05.06.2019:] final submission of exercises
		\item[12.06.2019:]
		\item[19.06.2019:] last corrections of exercises
		\item[26.06.2019:] exam
	\end{description}
\end{frame}

\begin{assignment}
	\frametitle{Tasks for today}
	(until 22.05.2019 23:59)

	\begin{task}
	All issues done.
	\end{task}
\end{assignment}

\begin{assignment}
	\frametitle{Tasks for today}
	(until 22.05.2019 23:59)

	\begin{task}
	Continue teamwork and homework.
	\end{task}
\end{assignment}

\begin{frame}
	\frametitle{Popular Topics}
	\vspace{-0.55cm}
	\setlength{\columnsep}{-1.3cm}
	\raggedright
	\definecolor{amethyst}{rgb}{0.6, 0.4, 0.8}
	\begin{multicols}{2}
	\begin{description}
	\item[14] {\color{orange} tools}
	\item[9] {\color{amethyst} testability}
	\item[9] {\color{gray} code-generation}
	\item[7] context-awareness
	\item[6] {\color{red} specification}
	\item[6] misconfiguration
	\item[6] {\color{gray} complexity reduction}
	\item[5] validation
	\item[5] {\color{amethyst} points in time} % (early detection)
	\item[5] error messages
	\item[5] {\color{gray} auto-detection}
	\item[4] user interface
	\item[4] {\color{red} introspection}
	\item[4] design
	\item[4] cascading
	\item[4] {\color{amethyst} architecture of access}
	\item[3] {\color{gray} configuration sources}
	\item[3] {\color{gray} config-less systems}
	\item[2] secure conf
	\item[2] {\color{gray} architectural decisions}
	\item[1] push vs.\ pull
	\item[1] infrastructure as code
	\item[1] full vs.\ partial
	\item[1] convention over conf %iguration
	\item[1] CI/CD
	\item[0] {\color{red} documentation}
	\end{description}
	\end{multicols}
\end{frame}



\begin{frame}
	\frametitle{Goals for today}
	\textit{learning outcome:}
	\begin{itemize}
	\item remember how to use configuration specification as documentation
	\item remember requirement for synchronization
	\item remember example of 3-way merge
	\item remember types of configuration
	\end{itemize}
\end{frame}








\begin{frame}
	\frametitle{Modularity (Recapitulation)}
	\pause
	\Large
	\ExecuteMetaData[../book/backend.tex]{definition-modularity}
\end{frame}


\begin{frame}
	\frametitle{Introspection (Recapitulation)}
	\begin{task}
	What is internal and external specification?
	What is introspection?
	\end{task}

	\pause
	\vspace{1em}

	\begin{itemize}
	\item internal: within applications' source code
	\item unified get/set access to (meta*)-key/values
	\item access via applications, CLI, GUI, web-UI, ...
	\item access via any programming language (similar to file systems)
	\item GUI, web-UI can semantically interpret metadata
	\item needed as communication of producers and consumers of configuration
	\item essential for \intro[no-futz computing]{no-futz computing}~\citet{holland2001nofutz}
	\end{itemize}
\end{frame}

\begin{frame}
	\frametitle{Guarantees (Recapitulation)}
	\begin{alertblock}{Question}
	How to ensure that configuration access points match with present configuration settings?
	\end{alertblock}

	\pause
	\vspace{1em}

	\textbf{Configuration Specification}:
	\begin{itemize}
	\item without specification you and others do not even know which settings are available
	\item needed for any further techniques we will discuss:
		\begin{itemize}
		\item code generation guarantees that configuration access points match with specification
		\item validation guarantees that configuration settings match with specification
		\end{itemize}
	\end{itemize}
\end{frame}


\begin{frame}
	\frametitle{Testing (Recapitulation)}
	\begin{alertblock}{Question}
	What do we want to test?
	What do we ask ourselves?
	\end{alertblock}

	\pause

	\begin{itemize}
	\item That settings do what they should (devs and admins)
	\item That settings are properly validated (devs~\cite{xu2013blame})
	\item Regression tests~\cite{qu2008configuration}
	\vspace{1em}
	\item Are all settings implemented?
	\item Are all settings used in tests?
	\item Are there unused settings in the code?
	\end{itemize}
\end{frame}

\begin{frame}
	\frametitle{When are settings used? (Recapitulation)}

	\pause

	\begin{description}[<+-| alert@+>]
	\item[Implementation-time] configuration accesses \index{implementation-time}
	are hard-coded settings in the sou\-rce code repository.
	For example, architectural decisions~\cite{zdun2007patterns} lead to impl\-ementation-time settings.

	\item[Compile-time] configuration accesses \index{compile-time}
	are configuration accesses resolved by the build system while compiling the code.

	\item[Deployment-time] configuration accesses \index{deployment-time}
	are configuration accesses while the software is installed.

	\item[Load-time] configuration accesses \index{load-time}
	are configuration accesses during the start of applications.

	\item[Run-time] configuration accesses \index{run-time}
	are configuration accesses during execution not limited to the startup procedure.
	\end{description}
\end{frame}

\begin{frame}
	\frametitle{Latent Misconfiguration (Recapitulation)}
	Phases when we can detect misconfigurations:
	\begin{itemize}[<+-| alert@+>]
	\item Compilation stage in configuration management tool
	\item Writing configuration settings on nodes
	\item Starting applications (load-time)
	\item When configuration setting is actually used (run-time)
	\end{itemize}

	\pause[\thebeamerpauses]

	\begin{alertblock}{Problem}
	More context vs. easier to detect and fix.
	\end{alertblock}
\end{frame}














%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% 
\section{Documentation}

\subsection{}


\begin{frame}
	\ExecuteMetaData[../book/motivation.tex]{documentation-inform}
\end{frame}

\begin{frame}
	There are at least two forms of documentation necessary:

	\begin{itemize}
	\item Explanations
	\item Examples
	\end{itemize}

	Generation helps to avoid duplication:

	\ExecuteMetaData[../book/motivation.tex]{documentation-req}
\end{frame}

\begin{frame}
	\begin{alertblock}{Question}
	How to avoid duplication between description text and other parts?
	\end{alertblock}

	\pause

	\begin{itemize}
	\item Render type and defaults into the documentation
	\item Render requirements and rationale into the documentation
	\item Use visibility to only show relevant configuration settings
	\end{itemize}
\end{frame}

\begin{frame}[fragile]
	\frametitle{Example}

	\begin{code}[gobble=4]
	[slapd/threads/listener]
	  check/range:=1,2,4,8,16
	  default:=1
	  description:=adjust to use more threads
	  rationale:=needed for many-core systems
	  requirement:=1234
	  visibility:=user
	\end{code}
\end{frame}

\begin{frame}
	\frametitle{Reevaluate specifications (Recapitulation)}

	In which situations should you reevaluate if a configuration setting (specification) is needed?

	\pause

	\ExecuteMetaData[../book/implications.tex]{reasons-adding}
\end{frame}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% 
\section{3-way merge}

\subsection{}

\begin{frame}
	\frametitle{Synchronization}

	Problem: transient and persistent configuration settings might be out-of-sync~\cite{jin2014configurations}

	\pause

	\ExecuteMetaData[../book/motivation.tex]{req-consistency}

	\pause

	Solutions:
	\begin{itemize}
	\item Often write out configuration settings.
	\item Many conflicts can be resolved with a semantic 3-way merge.
	\end{itemize}
\end{frame}

\begin{frame}
	\frametitle{Semantic 3-way merge}

	We can resolve many conflicts automatically, if we consider:
	\begin{itemize}
	\item the key/value structure (vs. line-based)
	\item the origin of both files
	\item the type of settings
	\end{itemize}

	For example, when upgrading slapd:

	\begin{itemize}
	\item System administrator changed the file (Ours).
	\item Package maintainer changed the file (Theirs).
	\end{itemize}
\end{frame}

\begin{frame}[fragile]
	\frametitle{Conflicts Example}

	\textbf{Ours:}
	\begin{code}[gobble=4,language=CfgElektra]
	slapd/threads/listener=4

	abc= \
		def
	\end{code}

	\textbf{Theirs:}
	\begin{code}[gobble=4,language=CfgElektra]
	abc = def
	slapd/threads/listener=8
	\end{code}

	\pause
	\textbf{Origin:}
	\begin{code}[gobble=4,language=CfgElektra]
	slapd/threads/listener=8
	abc=def
	\end{code}
\end{frame}





%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% 
\section{Team Work}

\subsection{}

\begin{frame}
	\frametitle{Step 1 (5 min)}

	Familiarize yourself with one of the configuration systems:

	\begin{enumerate}
	\item environment variables (Factor 12)
	\item QSettings
	\item Apache Commons Configurations
	\item plist
	\item Windows Registry
	\item any other system you want to... (laptop)
	\end{enumerate}
\end{frame}

\begin{frame}
	\frametitle{Step 2 (45 min)}

	Come together in a group

	\begin{enumerate}
	\item decide who will create flip chart, moderate, and present
	\item explain the system you looked into
	\item explain what the system could do for the task
	\item create together an architecture that fulfils the goals
	\end{enumerate}
\end{frame}

\begin{frame}
	\frametitle{Goals}

	\begin{enumerate}
	\item configuration-management friendly
	\item early detection of misconfiguration
	\item smooth upgrades
	\item transient and persistent configuration consistent
	\item consistent documentation
	\item suitable and context-aware configurations
	\item reuse software as much as possible but integrate them nicely
	\end{enumerate}
\end{frame}

\begin{frame}
	\frametitle{Requirements}

	Design a camera system:

	\begin{enumerate}
	\item that is able to take single pictures and streams
	\item pluggable camera modules (lenses, image sensor, ...)
	\item should have camera profiles for different vendors
	\item a Web-UI that shows all configuration settings
	\item support remote configuration protocol (Web, SNMP, CMs, ...)
	\item time synchronization via NTP
	\item should be easily upgradeable (with fallback if the upgrade fails)
	\end{enumerate}
\end{frame}

\begin{frame}
	\frametitle{Tasks}

	\begin{enumerate}
	\item design and architecture of configuration settings
	\item design and architecture of configuration access
	\item design decisions (which languages, which software)
	\item explain how to ensure smooth upgrades
	\item provide documentation for operators (via IP)
	\item ensure synchronized, suitable and context-aware configuration
	\item reuse software as much as possible but integrate them nicely
	\end{enumerate}
\end{frame}


\begin{frame}
	\frametitle{Outlook}

	\begin{enumerate}
	\item design and architecture of configuration settings
	\item design and architecture of configuration access
	\item design decisions (which languages, which software)
	\item explain how to ensure smooth upgrades
	\item provide documentation for operators (via IP)
	\item ensure synchronized, suitable and context-aware configuration
	\item reuse software as much as possible but integrate them nicely
	\end{enumerate}
\end{frame}









%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% 
\section{Context-Awareness}

\subsection{}

\begin{frame}
	If you're a baker, making bread, you're a baker. If you make the best bread in the world, you're not an artist, but if you bake the bread in the gallery, you're an artist. So the context makes the difference.\par\raggedleft--- \textup{Marina Abramovic}
\end{frame}

\begin{frame}
	\ExecuteMetaData[../book/background.tex]{context-definition}
\end{frame}

\begin{frame}
	\frametitle{Types of Configuration}
	\begin{description}
	\ExecuteMetaData[../book/background.tex]{context-types}
	\end{description}
\end{frame}

\begin{frame}
	\hspace*{-1em}\includegraphics{configurations}
\end{frame}

\begin{frame}
	\frametitle{Viewpoints}
	\begin{description}
	\item[Sensors:] derive context from information sources of the system.
	Adding new context sensors increases the context available in a system.
	\ExecuteMetaData[../book/background.tex]{context-viewpoints}
	\end{description}
\end{frame}

\begin{frame}
	\frametitle{Cascading (Recapitulation)}
	\includegraphics{cascading}
\end{frame}

\begin{frame}[fragile]
	\frametitle{Context-aware Lookup}

	\begin{itemize}
	\item
	Determine threads from CPUs:

	\begin{code}[gobble=4]
	[env/layer/cpu]
	  type:=long
	[slapd/threads/listener]
	  context:=/slapd/threads/%cpu%/listener
	\end{code}

	\item
	Determine vibration from sensors:

	\begin{code}[gobble=4]
	[phone/call/vibration]
	  type:=boolean
	  context:=/phone/call/%inpocket%/vibration
	\end{code}

	\item
	Determine proxy settings from network:

	\begin{code}[gobble=4]
	[env/override/http_proxy]
	  context:=/http_proxy/%interface%/%network%
	\end{code}
	\end{itemize}
\end{frame}







%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% 
\nocite{raab2017introducing}

\appendix

\begin{frame}[allowframebreaks]
	\bibliographystyle{plainnat}
	\bibliography{../shared/elektra.bib}
\end{frame}

\end{document}


%TODO: add cliffhanger with preview for next time
