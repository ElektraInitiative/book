%TODO: add cliffhanger with preview for next time

%variability
%code-generation
%testing

%modularity? + dependences

\input{setup}

\date{10.04.2019}

\begin{document}

\renewcommand{\enquote}[1]{\emph{``#1''}} % Cannot be done earlier

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{frame}
	\titlepage
	\doclicenseThis
\end{frame}


\begin{frame}
	Lecture is every week Wednesday 09:00 - 11:00.

	\begin{description}
		\item[06.03.2019:] {\color{gray}topic, teams}
		\item[13.03.2019:] {\color{gray}TISS registration, initial PR}
		\item[20.03.2019:] {\color{gray}other registrations, guest lecture}
		\item[27.03.2019:] {\color{gray}PR for first issue done, second started}
		\item[03.04.2019:] {\color{gray}first issue done, PR for second}
		\item[10.04.2019:] {\color{red}mid-term submission of exercises}
		\item[08.05.2019:] {\color{orange}Different Location: Complang Libary}
		\item[15.05.2019:]
		\item[22.05.2019:]
		\item[29.05.2019:]
		\item[05.06.2019:] final submission of exercises
		\item[12.06.2019:]
		\item[19.06.2019:] last corrections of exercises
		\item[26.06.2019:] exam
	\end{description}
\end{frame}

\begin{assignment}
	\frametitle{Tasks for today}
	(until 10.04.2019 23:59)

	mid-term submission of exercises
	
	\begin{task}
	Submit a first version of both teamwork and homework.
	\end{task}

	Does not need to be complete, important is that you get started.

	\begin{task}
	Second PR done, PR for third issue created and write some text in at least one other issue (if 5 issues are not yet assigned to you).
	\end{task}

	\begin{task}
	Write one architectural decision for your teamwork or Elektra.
	\end{task}
\end{assignment}

\begin{assignment}
	\frametitle{Tasks for after eastern}
	(until 08.05.2019 23:59)
	
	\begin{task}
	Incorporate feedback for teamwork and homework.
	\end{task}

	\begin{task}
	Third PR done, PR for fourth issue created and write some text in at least one other issue (if 5 issues are not yet assigned to you).
	\end{task}
\end{assignment}

\begin{frame}
	\frametitle{Popular Topics}
	\vspace{-0.55cm}
	\setlength{\columnsep}{-1.3cm}
	\raggedright
	\begin{multicols}{2}
	\begin{description}
	\item[14] tools
	\item[9] testability
	\item[9] code-generation
	\item[7] context-awareness
	\item[6] {\color{red} specification}
	\item[6] misconfiguration
	\item[6] {\color{gray} complexity reduction}
	\item[5] validation
	\item[5] points in time % (early detection)
	\item[5] error messages
	\item[5] {\color{red} auto-detection}
	\item[4] user interface
	\item[4] introspection
	\item[4] design
	\item[4] cascading
	\item[4] {\color{red} architecture of access}
	\item[3] {\color{gray} configuration sources}
	\item[3] {\color{red} config-less systems}
	\item[2] secure conf
	\item[2] {\color{gray} architectural decisions}
	\item[1] push vs.\ pull
	\item[1] infrastructure as code
	\item[1] full vs.\ partial
	\item[1] convention over conf %iguration
	\item[1] CI/CD
	\item[0] documentation
	\end{description}
	\end{multicols}
\end{frame}

\begin{frame}[fragile]
	\frametitle{Recapitulation}

	\begin{itemize}[<+-| alert@+>]
	\item alarming trend in number and complexity of configuration
	\item sharing, visibility and default value calculation may help
	\item but also more courageous decisions and periodical reevaluation
	\item both need abstraction: configuration specification
	\end{itemize}
\end{frame}

\begin{frame}
	\frametitle{Metalevels (Recapitulation)}
	\begin{alertblock}{Question}
	Describe the three Metalevels in Elektra.
	\end{alertblock}

	\pause
	\includegraphics{metalevels}
\end{frame}

\begin{frame}
	\frametitle{SpecElektra}

	\fontsize{18}{0}\selectfont
	\ExecuteMetaData[../book/approach.tex]{definition-spec}
\end{frame}

\begin{frame}
	\frametitle{Recapitulation (Requirements of SpecElektra)}

	\pause
	\begin{itemize}
	\item formal and informal
	\item should strive for completeness
	\item should be extensible
	\item should be external to application
	\item open for introspection (for tooling)
	\item should talk to users
	\item should allow generation of artefacts
	\end{itemize}
\end{frame}

\begin{frame}
	\frametitle{Goals for today}
	\begin{itemize}
	\item modularity on system level
	\begin{itemize}
	\item horizontal
	\item vertical
	\end{itemize}
	\item system-wide introspection
	\item avoiding dependences
	\item auto-detection
	\end{itemize}
\end{frame}




%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% 
\section{Modularity}


\begin{frame}
	\frametitle{Status Quo in Free Systems}

	\begin{itemize}[<+-| alert@+>]
	\item nearly all applications use their own configuration system
	\item immense differences in configuration file formats and configuration access
	\item very high modularity
	\end{itemize}
\end{frame}

\begin{frame}
	\frametitle{Status Quo in Frameworks and Proprietary Systems}

	\begin{itemize}[<+-| alert@+>]
	\item obvious ways how to deal with configuration
	\item no differences in configuration access
	\item very low modularity
	\end{itemize}
\end{frame}



\begin{frame}
	\frametitle{Types of Modularity}
	\Large
	\ExecuteMetaData[../book/backend.tex]{definition-modularity}
\end{frame}

\subsection{Vertical}

\begin{frame}[fragile]
	\frametitle{Vertical Modularity \cite{raab2016improving}}

	\intro[modularity!vertical]{Vertical modularity} is the degree of separation between different applications.
	If all applications use the same key database with a single backend or a single configuration file, applications would be coupled tightly.
	[...]

	If coupling between applications is low, for example every application uses a different configuration library or a different backend, we have a high degree of vertical modularity.
\end{frame}

\begin{frame}
	\frametitle{Retain Vertical Modularity \cite{raab2016improving}}

	\elektra{} provides two mechanisms to retain vertical modularity:

	\begin{itemize}
	\item \textbf{Mounting} configuration files facilitates different applications to use their own backend and their own configuration file.
	Furthermore, mounting enables integrating existing configuration files into the key database.
	Configuration specifications written in \elektra{Spec} allow different applications to share their configuration files with each other in a controlled way.

	%TODO: Duplicate
	\item Having frontends that implement existing \textbf{APIs} decouple applications from each other.
	These applications continue to use their specific configuration accesses, but \elektra{} redirects their configuration accesses to the shared key database.
	\end{itemize}
\end{frame}

\begin{frame}[fragile]
	\frametitle{Vertical Modularity \cite{raab2016improving}}
	Mountpoints can also be a part of the specification:

	\begin{code}[language=Cpp,gobble=4,showspaces=no]
	[ntp]
	  mountpoint:=ntp.conf
	[sw/libreoffice]
	  mountpoint:=libreoffice.conf
	\end{code}

	\begin{task}
	Which type of specification is this?
	\end{task}
\end{frame}

\begin{frame}
	\frametitle{Types of Specifications}
	\includegraphics[scale=0.8]{specifications}
\end{frame}

\begin{frame}
	\frametitle{Vertical Modularity}
	\begin{columns}[c]
	\column{7cm}
	\includegraphics[scale=0.75]{verticalmodularity}
	\column{4cm}
	Needed to keep applications independently.

	Boxes are applications, cylinders are configuration files, F? are frontends or frontend adapters, L? are configuration libraries~\cite{raab2016improving}.
	\end{columns}
\end{frame}

\begin{assignment}
	\begin{task}
	Break.
	\end{task}
\end{assignment}


\subsection{Horizontal}

\begin{frame}
	\frametitle{Horizontal Modularity \cite{raab2016improving}}

	\intro[Modularity!horizontal]{Horizontal modularity} is ``the degree of separation in configuration access code''~\cite{raab2016improving}. 
	A higher degree of horizontal modularity allows us to better separate configuration access code and plug the code together as needed.
\end{frame}

\begin{frame}
	\label{slide:horizontal-modularity}
	Three factors of \elektra{Spec} improve horizontal modularity:
	\begin{enumerate}
	\item
	Using \elektra{Spec}, applications are completely decoupled from configuration specifications.

	\item
	Specifications and their implementation are decoupled.

	\item
	Abstract dependences within the implementation of specifications.
	\end{enumerate}

	\begin{task}
	This is very vague.

	Can you describe a system that would (not) fulfil this?
	\end{task}
\end{frame}

\begin{frame}
	\frametitle{Horizontal Modularity}
	\begin{columns}[c]
	\column{7cm}
	\includegraphics[scale=0.95]{horizontalmodularity}
	\column{4cm}
	Needed for validation, auto-detection, \dots \\[1cm]

	Cylinders are configuration files, P? are plugins~\cite{raab2016improving}
	\end{columns}
\end{frame}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% 
\section{Plugins}

\subsection{Why?}

\begin{frame}[fragile]
	\frametitle{Acceptable Effort}

	\methodQuestion{} \question{Which effort do you think is worthwhile for providing better configuration experience?}

	\begin{itemize}
	\item \p{44} would use other configuration access APIs next to ^getenv^.
	\item \p{30} would use OS-specific sources.
	\item \p{21} would use dedicated libraries.
	\item \p{19} would read other application's configuration settings,
	\item \p{16} would use external configuration access APIs that add new dependences.
	\end{itemize}
\end{frame}


\begin{frame}
	\frametitle{Why?}
	\begin{finding}
	\methodQuestion{}
	Most developers have concerns adding dependences for more validation~(\p{84}) but consider good defaults important (\p{80}).
	\end{finding}

	\begin{restatable}{requirement}{reqDependences}
	\label{req:dependences}
	Dependences exclusively needed to validate configuration settings must be avoided.
	\end{restatable}
\end{frame}

\begin{frame}
	\frametitle{Rationale}
	Why is it difficult to have good defaults?
	\begin{itemize}[<+->]
	\item \textbf{Modularity:} diverse and conflicting requirements between applications.
	Especially in validation, for example, \linebreak
	constraint solvers vs. type systems vs. model checkers.
	\item \textbf{System-level:} specification must always be enforced. Examples:
	\begin{itemize}[<+-| alert@+>]
	\item which desktop is the application started in?
	\item how many CPUs does the system have?
	\item get the correct proxy of the system.
	\item get available network bandwidth.
	\item is the filesystem local?
	\end{itemize}
	\end{itemize}
\end{frame}

\subsection{How?}

\begin{frame}
	\Large
	\ExecuteMetaData[../book/approach.tex]{definition-plugins}
\end{frame}

\begin{frame}
	\frametitle{KeySet}

	The common data structure between plugins:
	\vspace{1cm}

	\includegraphics{keyset}
\end{frame}

\begin{frame}[fragile]
	\frametitle{Plugin Assembly}

	automatic assembling of plugins:

	\begin{itemize}[<+->]
	\item iterate over the specification and collect all key words
	\item iterate over all plugins and check if they offer key words
	\item check contract between plugins and specification
	\item of the remaining plugins: use best suited or rated
	\end{itemize}

	\vspace{1cm}

	\pause[\thebeamerpauses]

	(implemented in ^kdb mount^ / ^kdb spec-mount^ in Elektra)
\end{frame}

\begin{frame}
	SpecElektra is a dependency injection mechanism:

	\begin{itemize}[<+->]
	\item By extending the specification, new plugins are being injected into the system.
	\item The \empha{provider} abstractions in the dependences between the plugins abstract over concrete implementations of configuration access code.
	\item We have a modular implementation of SpecElektra.
	\end{itemize}

	\onslide<+->{
	\begin{task}
	Which kind of modularity does \empha{provider} improve?
	\end{task}
	}

	\onslide<+->{
	\begin{answer}
	3\textsuperscript{rd} point of horizontal modularity on Slide~\ref{slide:horizontal-modularity}
	\end{answer}
	}
\end{frame}

\begin{frame}[fragile]
	\frametitle{Examples}
	calculation with context:
	\begin{code}[gobble=4]
	[gps/status]
	assign:=(battery > 'low') ? ('on') : ('off')
	[battery]
	plugins:=battery
	\end{code}
\end{frame}

\begin{frame}[fragile]
	\frametitle{Examples}
	resolve names of configuration files
	\vspace{0.3cm}

	\begin{code}[language=Cpp,gobble=4,showspaces=no]
	[example]
	  mountpoint:=/example.ini
	\end{code}
	\vspace{1cm}

	depending on operating system, e.g. UNIX:
	\vspace{0.3cm}
	\centering
	\begin{tabular}{|c|c|} \hline
	namespace & resolved path \\ \hline
	^spec^ & ^/example.ini^ \\ \hline
	^dir^ & ^${PWD}/example.ini^ \\ \hline
	^user^ & ^${HOME}/example.ini^ \\ \hline
	^system^ & ^/example.ini^ \\ \hline
	\end{tabular}
\end{frame}


\begin{frame}
	\frametitle{Preview}
	next lecture after eastern:

	code generation vs. introspection
\end{frame}



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% 
\nocite{raab2016improving}

\appendix

\begin{frame}[allowframebreaks]
	\bibliographystyle{plainnat}
	\bibliography{../shared/elektra.bib}
\end{frame}

\end{document}


